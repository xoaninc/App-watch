# Linter & Compile Agent

Run static analysis, linting, and compilation checks to catch errors before runtime.

## Purpose

Ensure code passes all static analysis checks, follows coding standards, and compiles without errors before committing or deploying.

## When to Use

Run this agent:
- Before committing code
- After making changes
- Before code review
- As part of CI/CD pipeline

## Instructions

### Step 1: Identify Project Stack

Detect the project's technology stack by checking for:
- `package.json` → Node.js/JavaScript/TypeScript
- `composer.json` → PHP
- `requirements.txt` / `pyproject.toml` → Python
- `go.mod` → Go
- `Cargo.toml` → Rust
- `pom.xml` / `build.gradle` → Java

### Step 2: Run Static Analysis

Based on stack, run appropriate tools:

#### PHP
```bash
# PHPStan - Static Analysis
vendor/bin/phpstan analyse

# PHP CS Fixer - Code Style
vendor/bin/php-cs-fixer fix --dry-run --diff

# Psalm (if configured)
vendor/bin/psalm
```

#### TypeScript/JavaScript
```bash
# TypeScript Compiler
npx tsc --noEmit

# ESLint
npx eslint . --ext .ts,.tsx,.js,.jsx

# Prettier Check
npx prettier --check .
```

#### Python
```bash
# MyPy - Type Checking
mypy .

# Pylint / Flake8
pylint src/
flake8 src/

# Black - Formatting Check
black --check .
```

#### Go
```bash
# Go Vet
go vet ./...

# Golint
golint ./...

# Go Build
go build ./...
```

### Step 3: Analyze Results

For each error/warning:
1. Identify file and line
2. Understand the issue
3. Categorize severity
4. Suggest fix

### Step 4: Check for Common Issues

- [ ] Unused imports
- [ ] Unused variables
- [ ] Type mismatches
- [ ] Undefined variables/methods
- [ ] Deprecated function usage
- [ ] Security vulnerabilities
- [ ] Code style violations

## Output Format

```markdown
# Linter & Compile Report

**Date:** [date]
**Status:** PASS | FAIL
**Tools Run:** [list of tools]

---

## Summary

| Tool | Status | Errors | Warnings |
|------|--------|--------|----------|
| [PHPStan] | PASS/FAIL | X | Y |
| [ESLint] | PASS/FAIL | X | Y |
| [TypeScript] | PASS/FAIL | X | Y |

**Total Errors:** X
**Total Warnings:** Y

---

## Errors (Must Fix)

### Error 1: [Type/Category]

**File:** `[path/to/file]`
**Line:** [line number]
**Tool:** [tool name]

**Message:**
```
[error message from tool]
```

**Code:**
```
[relevant code snippet]
```

**Fix:**
```
[corrected code]
```

**Explanation:**
[Why this is an error and how the fix resolves it]

---

### Error 2: [Type/Category]
[...]

---

## Warnings (Should Fix)

### Warning 1: [Type/Category]

**File:** `[path/to/file]`
**Line:** [line number]
**Tool:** [tool name]

**Message:**
```
[warning message]
```

**Recommendation:**
[How to address this warning]

---

## Suppressed/Ignored Issues

| File | Line | Issue | Reason for Suppression |
|------|------|-------|----------------------|
| [file] | [line] | [issue] | [reason - should be documented] |

---

## Code Style Violations

| File | Line | Rule | Issue |
|------|------|------|-------|
| [file] | [line] | [rule-name] | [description] |

---

## Auto-Fixable Issues

The following issues can be auto-fixed:

```bash
# Run these commands to auto-fix:
[command 1]
[command 2]
```

**Files that will be modified:**
- [file1]
- [file2]

---

## Type Errors

### Strict Type Issues

| File | Line | Expected | Actual | Fix |
|------|------|----------|--------|-----|
| [file] | [line] | `string` | `string\|null` | Add null check |

### Missing Types

| File | Line | Issue |
|------|------|-------|
| [file] | [line] | Missing return type |
| [file] | [line] | Missing parameter type |

---

## Deprecated Usage

| File | Line | Deprecated | Replacement |
|------|------|------------|-------------|
| [file] | [line] | `oldFunction()` | `newFunction()` |

---

## Security Issues

| File | Line | Issue | Severity | Fix |
|------|------|-------|----------|-----|
| [file] | [line] | [issue] | Critical/High/Medium | [fix] |

---

## Configuration Suggestions

### Stricter Rules Recommended

```json
// Add to configuration:
{
  "rules": {
    "[rule]": "error"
  }
}
```

### Ignored Rules Review

These rules are currently ignored but should be enabled:
- `[rule]` - [reason to enable]

---

## CI/CD Integration

### Recommended Pipeline Configuration

```yaml
# Example GitHub Actions
lint:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v3
    - name: Run Linter
      run: |
        [lint commands]
    - name: Run Type Check
      run: |
        [type check commands]
```

---

## Next Steps

### If PASS:
- [ ] Commit code
- [ ] Proceed to code review

### If FAIL:
1. Fix all errors (red)
2. Address high-priority warnings
3. Re-run linter
4. Verify PASS status
```

## Common Static Analysis Errors

### PHP - PHPStan

| Level | Meaning |
|-------|---------|
| 0 | Basic checks |
| 1 | Possibly undefined variables |
| 2 | Unknown methods on object |
| 3 | Return types |
| 4 | Basic dead code |
| 5 | Method arguments |
| 6 | Report missing typehints |
| 7 | Union types |
| 8 | Nullable types |
| 9 | Mixed type |

### TypeScript

| Code | Meaning |
|------|---------|
| TS2304 | Cannot find name |
| TS2322 | Type not assignable |
| TS2345 | Argument type mismatch |
| TS2531 | Object possibly null |
| TS7006 | Parameter implicitly has 'any' |

## Auto-Fix Commands

### PHP
```bash
# Fix code style
vendor/bin/php-cs-fixer fix

# Fix rector issues
vendor/bin/rector process
```

### TypeScript/JavaScript
```bash
# Fix ESLint issues
npx eslint . --fix

# Fix Prettier issues
npx prettier --write .
```

### Python
```bash
# Fix with Black
black .

# Fix imports with isort
isort .
```

## Tips

- Run linter locally before pushing
- Set up pre-commit hooks
- Configure IDE to show lint errors
- Start with stricter rules on new code
- Gradually increase strictness level
