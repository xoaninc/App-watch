# Check Definition of Done Agent

Verify that a completed implementation meets all requirements and quality standards before marking it as done.

## Purpose

Ensure that all acceptance criteria, testing requirements, and quality gates have been satisfied before considering a feature complete.

## When to Use

Run this agent:
- After all implementation tasks are complete
- Before requesting code review
- Before deploying to staging
- Before UAT sign-off

## Prerequisites

1. All implementation tasks from `/docs/requirements/tasks/[feature]-tasks.md` marked complete
2. Access to the original requirement document
3. Access to the solution design document

## Input

- Path to the requirement document
- Path to the tasks document
- Git branch or commit with the implementation

## Instructions

### Step 1: Load Documents

Read:
1. Original requirement document
2. Solution design document
3. Tasks document
4. `/ai_docs/architecture/critical-rules.md`

### Step 2: Verify Acceptance Criteria

For EACH acceptance criterion in the requirement:
- Check if implemented
- Verify with code evidence
- Mark as PASS or FAIL

### Step 3: Verify Task Completion

For EACH task in the tasks document:
- Verify files exist
- Verify acceptance criteria met
- Check for TODO/FIXME comments

### Step 4: Code Quality Checks

Verify:
- [ ] No hardcoded values (use config/constants)
- [ ] No debug code left (console.log, var_dump, dd)
- [ ] No commented-out code
- [ ] No TODO/FIXME without ticket reference
- [ ] Proper error handling
- [ ] No security vulnerabilities (OWASP top 10)

### Step 5: Architecture Compliance

Verify:
- [ ] Follows DDD structure
- [ ] CQRS separation (Commands vs Queries)
- [ ] Thin Actions (no business logic)
- [ ] Repository pattern used correctly
- [ ] No framework validation in Requests (only getDto)

### Step 6: Testing Verification

Verify:
- [ ] Unit tests exist and pass
- [ ] Integration tests exist and pass
- [ ] Feature tests exist and pass
- [ ] Test coverage meets minimum threshold
- [ ] Edge cases covered

### Step 7: Documentation Check

Verify:
- [ ] API documentation updated (if applicable)
- [ ] README updated (if needed)
- [ ] Inline documentation for complex logic
- [ ] Migration has clear description

### Step 8: Performance Considerations

Verify:
- [ ] No N+1 queries
- [ ] No queries in loops
- [ ] Proper indexing in migrations
- [ ] Large data sets considered

## Output Format

```markdown
# Definition of Done Report: [Feature Name]

**Requirement:** [link]
**Solution Design:** [link]
**Tasks:** [link]
**Branch:** [branch name]
**Date:** [date]
**Status:** PASS | FAIL | PARTIAL

---

## Summary

| Category | Status | Issues |
|----------|--------|--------|
| Acceptance Criteria | X/Y PASS | [count] issues |
| Task Completion | X/Y PASS | [count] issues |
| Code Quality | PASS/FAIL | [count] issues |
| Architecture | PASS/FAIL | [count] issues |
| Testing | PASS/FAIL | [count] issues |
| Documentation | PASS/FAIL | [count] issues |
| Performance | PASS/FAIL | [count] issues |

---

## 1. Acceptance Criteria Verification

| ID | Criterion | Status | Evidence |
|----|-----------|--------|----------|
| AC-001 | [criterion text] | PASS/FAIL | [file:line or explanation] |
| AC-002 | [criterion text] | PASS/FAIL | [file:line or explanation] |

### Failed Criteria Details

#### AC-XXX: [criterion]
**Issue:** [description]
**Required Action:** [what needs to be done]

---

## 2. Task Completion Verification

| Task | Status | Notes |
|------|--------|-------|
| TASK-001 | COMPLETE/INCOMPLETE | [notes] |
| TASK-002 | COMPLETE/INCOMPLETE | [notes] |

### Incomplete Tasks

#### TASK-XXX: [task name]
**Missing:** [what's missing]
**Required Action:** [what needs to be done]

---

## 3. Code Quality

### Checks Performed
- [ ] No hardcoded values
- [ ] No debug code
- [ ] No commented-out code
- [ ] No untracked TODOs
- [ ] Proper error handling
- [ ] No security vulnerabilities

### Issues Found

| File | Line | Issue | Severity |
|------|------|-------|----------|
| [file] | [line] | [issue description] | High/Medium/Low |

---

## 4. Architecture Compliance

### Checks Performed
- [ ] DDD structure followed
- [ ] CQRS separation correct
- [ ] Actions are thin
- [ ] Repository pattern correct
- [ ] Request pattern correct (no rules())

### Violations Found

| File | Violation | Required Fix |
|------|-----------|--------------|
| [file] | [violation] | [fix] |

---

## 5. Testing Verification

### Test Results
| Test Type | Total | Passed | Failed | Coverage |
|-----------|-------|--------|--------|----------|
| Unit | X | X | X | X% |
| Integration | X | X | X | X% |
| Feature | X | X | X | X% |

### Missing Tests
| Scenario | Type | Priority |
|----------|------|----------|
| [scenario] | Unit/Integration/Feature | High/Medium/Low |

### Failed Tests
| Test | Reason | Required Fix |
|------|--------|--------------|
| [test name] | [failure reason] | [fix] |

---

## 6. Documentation Check

- [ ] API docs updated
- [ ] README updated
- [ ] Complex logic documented
- [ ] Migration documented

### Missing Documentation
| Item | Required |
|------|----------|
| [item] | [what's needed] |

---

## 7. Performance Check

- [ ] No N+1 queries
- [ ] No queries in loops
- [ ] Proper indexes
- [ ] Large data considered

### Performance Issues
| Location | Issue | Impact | Fix |
|----------|-------|--------|-----|
| [file:line] | [issue] | [impact] | [fix] |

---

## Final Verdict

### Status: [PASS / FAIL / PARTIAL]

### Blocking Issues (Must Fix)
1. [Issue 1]
2. [Issue 2]

### Non-Blocking Issues (Should Fix)
1. [Issue 1]
2. [Issue 2]

### Recommendations
1. [Recommendation 1]
2. [Recommendation 2]

---

## Next Steps

If **PASS:**
- [ ] Request code review
- [ ] Merge to main/develop
- [ ] Deploy to staging
- [ ] Schedule UAT

If **FAIL:**
- [ ] Fix blocking issues
- [ ] Re-run DoD check
- [ ] Document fixes made
```

## Pass Criteria

To pass DoD:
- ALL acceptance criteria must be PASS
- ALL tasks must be COMPLETE
- NO blocking code quality issues
- NO architecture violations
- ALL tests must pass
- Critical documentation must exist
- NO critical performance issues

## Tips

- Be thorough but not pedantic
- Focus on blocking issues first
- Provide actionable fix recommendations
- Consider the feature holistically
- Check for regression potential
